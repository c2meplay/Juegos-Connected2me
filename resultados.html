<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados - Besedoplay</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Quicksand', sans-serif;
      background-color: #f4f0fa;
      background-image: url('fondo.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .container {
      max-width: 1000px;
      margin: 100px auto 60px;
      background-color: rgba(64, 18, 104, 0.15);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 0 16px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(4px);
    }

    h1 {
      text-align: center;
      font-size: 42px;
      color: #401268;
      margin-bottom: 30px;
    }

    .tabs {
      text-align: center;
      margin-bottom: 30px;
    }

    .tabs button {
      background-color: #fff;
      color: #401268;
      font-weight: bold;
      border: 2px solid #401268;
      border-radius: 20px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .tabs button.active, .tabs button:hover {
      background-color: #401268;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      padding: 14px;
      text-align: center;
      border-bottom: 1px solid #ddd;
      font-size: 16px;
    }

    th {
      background-color: #401268;
      color: white;
    }

    tr:hover {
      background-color: #f3ebfa;
    }

    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }

      th {
        display: none;
      }

      td {
        position: relative;
        padding-left: 50%;
      }

      td::before {
        content: attr(data-label);
        position: absolute;
        left: 16px;
        font-weight: bold;
        color: #401268;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Resumen de Puntajes</h1>
    <div class="tabs">
      <button onclick="filtrar('todos')" class="active">Todos</button>
      <button onclick="filtrar('Búsqueda')">Búsqueda</button>
      <button onclick="filtrar('Diferencia')">Diferencia</button>
      <button onclick="filtrar('Juego 3')">Juego 3</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Jugador</th>
          <th>Juego</th>
          <th>Total de Puntos</th>
        </tr>
      </thead>
      <tbody id="tabla-resumen"></tbody>
    </table>
  </div>

  <h1 style="margin-top: 60px;">Total General por Jugador</h1>
  <table>
    <thead>
      <tr>
        <th>Jugador</th>
        <th>Puntaje Total</th>
      </tr>
    </thead>
    <tbody id="tabla-total"></tbody>
  </table>

<script>
  const url = "https://docs.google.com/spreadsheets/d/13hbWwDx5JEoA6A3OQB_hF6Ii8aD7RQUz6RfRFscD0iA/gviz/tq?tqx=out:json";
  let datosAgrupados = [];
  let resumenTotal = {};

  function filtrar(filtro) {
    document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    const cuerpo = document.getElementById("tabla-resumen");
    cuerpo.innerHTML = "";

    const filtrados = datosAgrupados
      .filter(d => filtro === 'todos' || d.juego === filtro)
      .sort((a, b) => b.puntaje - a.puntaje); // Ordenar de mayor a menor

    filtrados.forEach(d => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${d.jugador}</td>
        <td>${d.juego}</td>
        <td>${d.puntaje}</td>
      `;
      cuerpo.appendChild(tr);
    });
  }

  function renderResumenTotal() {
    const cuerpo = document.getElementById("tabla-total");
    cuerpo.innerHTML = "";

    const ordenados = Object.entries(resumenTotal).map(([jugador, puntaje]) => ({ jugador, puntaje }))
      .sort((a, b) => b.puntaje - a.puntaje);

    ordenados.forEach(d => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${d.jugador}</td>
        <td>${d.puntaje}</td>
      `;
      cuerpo.appendChild(tr);
    });
  }

  fetch(url)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      const acumulado = {};
      resumenTotal = {};

      rows.forEach(row => {
        if (!row.c) return;
        const jugador = row.c[0]?.v || '';
        const puntaje = parseInt(row.c[1]?.v || '0');
        const juego = row.c[2]?.v || '';

        const clave = `${jugador}_${juego}`;
        if (!acumulado[clave]) {
          acumulado[clave] = { jugador, juego, puntaje: 0 };
        }
        acumulado[clave].puntaje += puntaje;

        if (!resumenTotal[jugador]) {
          resumenTotal[jugador] = 0;
        }
        resumenTotal[jugador] += puntaje;
      });

      datosAgrupados = Object.values(acumulado);
      filtrar("todos");
      renderResumenTotal();
    })
    .catch(err => console.error("Error al cargar:", err));
</script>
</body>
</html>
